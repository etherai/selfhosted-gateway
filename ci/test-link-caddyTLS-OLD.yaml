version: '3.9'

networks:
  gateway:
      external: true

services:
  nginx:
    image: nginx:latest
    networks:
      - gateway
    volumes:
      - ./nginx/conf:/etc/nginx/conf.d
      - ./nginx:/root/nginx
    entrypoint: /root/nginx/entrypoint.sh
  link:
    image: fractalnetworks/gateway-client:latest
    environment:
      LINK_DOMAIN: app.example.com
      EXPOSE: https://nginx
      GATEWAY_CLIENT_WG_PRIVKEY: OIIH7ZyPZ7QnypcLv0/dUmat5Bt74IctlEw1cyjj3FA=
      GATEWAY_LINK_WG_PUBKEY: Jns+uf1vl/fgA9MiviDVQYgLJ2MPu2LETPFkMFnh2CE=
      GATEWAY_ENDPOINT: app-example-com:18521
      # Remove to disable basic auth
      BASIC_AUTH: admin:admin
      # Remove to fetch "real" tls certs instead of generating self-signed ones
      TLS_INTERNAL: true

      CADDY_TLS_PROXY: true
      CADDY_TLS_INSECURE: true # optional, allows for self-signed certs 
      # FORWARD_ONLY: true
      
    cap_add:
      - NET_ADMIN
    networks:
      - gateway